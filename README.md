# AffinityAPI

The is a PowerShell wrapper for the [Affinity](https://www.affinity.co) API. The aim of the project is to be able to provide robust coverage of the all available REST methods, while handling authentication, caching, etc. in a PowerShell-native style.

## Getting Started

Before undergoing a scripting project, it is advised to spend some time reviewing Affinity's data model and API documentation that can be found [here](https://api-docs.affinity.co).

### Prerequisites

There are two prerequisites to run use this module:
1. **Affinity API Key**. Can be generated by logging into Affinity and going to *Settings* > *API* > *Generate an API key*
2. **Powershell**. Either Windows PowerShell 5.1+ or PowerShell Core 6.0+ is fine (earlier versions will probably work but have not been tested)

### Installing

There are two main methods to install this PowerShell module:

#### 1) PowerShell Gallery (preferred)

```powershell
# If the user has admin rights:
Install-Module -Name AffinityAPI
# If the user has user rights:
Install-Module -Name AffinityAPI -Scope CurrentUser
# If the user has very limited rights:
Save-Module -Name AffinityAPI
```
#### 2) Manual


*Clone or download* > *Download ZIP*
Unzip `AffinityAPI` folder to a PowerShell module folder


### Usage
Once the module is installed, usage is pretty straightforward

```powershell
# First, import AffinityAPI
Import-Module AffinityAPI

# If the module is properly installed, the module will also auto-load based on functions called

# Next, prompt user for username and API key (any username is acceptable)
Set-AffinitySetting         

# Optionally, export settings to an encrypted .cred file
Export-AffinitySetting

# Optionally, import .cred file to avoid prompting the user at runtime
Import-AffinitySetting -SettingUserName username

# Typically in automated settings, Set-AffinitySetting and Export-AffinitySetting would only 
# be run once for each computer / user combination.

# In interactive settings, just calling Set-AffinitySetting will collect the user's credentials at runtime

# Finally, start scripting
$ListEntries = Get-AffinityListEntry -ListName 'List'

foreach ($entry in $ListEntries) {
    $EntryFieldValues = Get-AffinityFieldValue -OrganizationID $entry.entity.id -ListID $entry.list_id -Expand
    Write-Output $EntryFieldValues.'Status'.field_value
}
```

## Function Reference

As of May 2019, there are 30 logical functions that should be coded based on the available API methods. 13 are usable, while 17 functions still need to be coded (representing ~43% coverage).

Best efforts have been made to conform to PowerShell naming conventions and best practices. Here's the reference for all of the functions developed to-date:

| Affinity<br/>Resource           | Create<br/>`New-`       | Read<br/>`Get-`                | Update<br/>`Set-`       | Delete<br/>`Remove-`       | Search<br/>`Find-`|
| ------------------------------- |:-----------------------:|:------------------------------:|:-----------------------:|:--------------------------:|:-----------------:|
| Entity Files                    | *TBD*                   | *TBD*                          | ~~NA~~                  | ~~NA~~                     | ~~NA~~            |
| Field Values                    | New-AffinityFieldValue  | Get-AffinityFieldValue         | Set-AffinityFieldValue  | Remove-AffinityFieldValue  | ~~NA~~            |
| List Entries                    | *TBD*                   | Get-AffinityListEntry          | ~~NA~~                  | *TBD*                      | ~~NA~~            |
| Lists                           | ~~NA~~                  | Get-AffinityList               | ~~NA~~                  | ~~NA~~                     | ~~NA~~            |
| Notes                           | New-AffinityNote        | Get-AffinityNote               | ~~NA~~                  | ~~NA~~                     | ~~NA~~            |
| Opportunities                   | New-AffinityOpportunity | Get-AffinityOpportunity        | Set-AffinityOpportunity | Remove-AffinityOpportunity | *TBD*             |
| Organizations                   | *TBD*                   | *TBD*                          | *TBD*                   | *TBD*                      | *TBD*             |
| Org. Global<br/>Field Headers   | ~~NA~~                | Get-Affinity<br/>GlobalFieldHeader | ~~NA~~                | ~~NA~~                     | ~~NA~~            |
| Persons                         | *TBD*                   | *TBD*                          | *TBD*                   | *TBD*                      | *TBD*             |
| Person Global<br/>Field Headers | ~~NA~~                  | *TBD*                          | ~~NA~~                  | ~~NA~~                     | ~~NA~~            |
| Relationship<br/>Strength       | ~~NA~~                  | *TBD*                          | ~~NA~~                  | ~~NA~~                     | ~~NA~~            |

## Authors

* **Burke Davis** - *Initial work* - [burkasaurusrex](https://github.com/burkasaurusrex)

See also the list of [contributors](https://github.com/sorensoncapital/affinity-api-powershell-wrapper/graphs/contributors) who participated in this project.

## License

This project is licensed under the GPL License - see the [license](LICENSE) file for details

## Acknowledgments

* [Adam Najmanowicz](https://blog.najmanowicz.com) and [Michael West](https://michaellwest.blogspot.com) at [SitecorePowerShell](https://github.com/SitecorePowerShell) for the [ConvertFrom-CliXml](https://github.com/SitecorePowerShell/Console/blob/master/Modules/SPE/ConvertFrom-CliXml.ps1) and [ConvertTo-CliXml](https://github.com/SitecorePowerShell/Console/blob/master/Modules/SPE/ConvertTo-CliXml.ps1) modules
<!--stackedit_data:
eyJoaXN0b3J5IjpbMTk2NjY4NzMxOF19
-->